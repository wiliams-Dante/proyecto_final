#include <iostream>
#include <string>
using namespace std;

// =============================
// Clase base Documentos
class Documentos {
protected:
    string numero;  // numero de documento

public:
    Documentos() {}

    Documentos(const string& num) {
        numero = num;
    }

    void setNumero(const string& num) {
        numero = num;
    }

    string getNumero() const {
        return numero;
    }
};

// =============================
// DNI hereda de Documentos
// =============================
class DNI : public Documentos {
private:
    string nombres;
    string apellidos;
    string nacionalidad;
    string sexo;

public:
    DNI() : Documentos() {}

    DNI(const string& nom, const string& ape,
        const string& nac, const string& sx,
        const string& num)
        : Documentos(num)
    {
        nombres = nom;
        apellidos = ape;
        nacionalidad = nac;
        sexo = sx;
    }

    string getNombres() const { return nombres; }
    string getApellidos() const { return apellidos; }
    string getNacionalidad() const { return nacionalidad; }
    string getSexo() const { return sexo; }
};

// =============================
// VISA hereda de Documentos
// =============================
class VISA : public Documentos {
private:
    string tipo;
    string paisDestino;
    string fechaEmision;
    string fechaVencimiento;

public:
    VISA() : Documentos() {}

    VISA(const string& num, const string& tipoVisa, const string& paisDest,
         const string& fEmi, const string& fVen)
        : Documentos(num)
    {
        tipo = tipoVisa;
        paisDestino = paisDest;
        fechaEmision = fEmi;
        fechaVencimiento = fVen;
    }

    string getPaisDestino() const { return paisDestino; }
    string getTipo() const { return tipo; }
};

// =============================
// Clase Vuelo (boleto)
// =============================
class Vuelo
{
private:
    string paisDestino;
    string aerolinea;
    string horaSalida;
    string horaLlegada;
    string fecha;
    int    cantidadAsientos;

    static const int MAX_ASIENTOS = 10;
    int filas[MAX_ASIENTOS];
    int columnas[MAX_ASIENTOS];

    int indexPais;
    int indexHorario;

public:
    Vuelo(string p = "", string a = "",
          string hs = "", string hl = "",
          string f = "", int cant = 0,
          int idxPais = -1, int idxHor = -1)
    {
        paisDestino = p;
        aerolinea = a;
        horaSalida = hs;
        horaLlegada = hl;
        fecha = f;
        cantidadAsientos = 0; // se llenará con agregarAsiento
        indexPais = idxPais;
        indexHorario = idxHor;
    }

    void agregarAsiento(int fila, int columna) {
        if (cantidadAsientos < MAX_ASIENTOS) {
            filas[cantidadAsientos] = fila;
            columnas[cantidadAsientos] = columna;
            cantidadAsientos++;
        }
    }

    void setAsiento(int indice, int fila, int columna) {
        if (indice >= 0 && indice < MAX_ASIENTOS) {
            filas[indice] = fila;
            columnas[indice] = columna;
        }
    }

    int getFilaAsiento(int indice) const {
        if (indice >= 0 && indice < cantidadAsientos) return filas[indice];
        return -1;
    }

    int getColumnaAsiento(int indice) const {
        if (indice >= 0 && indice < cantidadAsientos) return columnas[indice];
        return -1;
    }

    // Getters
    string getPaisDestino()   const { return paisDestino; }
    string getHoraSalida()    const { return horaSalida; }
    string getHoraLlegada()   const { return horaLlegada; }
    string getFecha()         const { return fecha; }
    int    getCantidad()      const { return cantidadAsientos; }

    int getIndexPais() const      { return indexPais; }
    int getIndexHorario() const   { return indexHorario; }

    // Setters
    void setFecha(const string& f)          { fecha = f; }
    void setHoraSalida(const string& hs)    { horaSalida = hs; }
    void setHoraLlegada(const string& hl)   { horaLlegada = hl; }
    void setCantidadAsientos(int c)         { cantidadAsientos = c; }
    void setIndexPais(int ip)              { indexPais = ip; }
    void setIndexHorario(int ih)           { indexHorario = ih; }

    void mostrarBoleto() const
    {
        cout << "\n=========== BOLETO DE VUELO ===========" << endl;
        cout << "Destino:       " << paisDestino << endl;
        cout << "Fecha:         " << fecha << endl;
        cout << "Aerolinea:     " << aerolinea << endl;
        cout << "Hora salida:   " << horaSalida << endl;
        cout << "Hora llegada:  " << horaLlegada << endl;
        cout << "Asientos:      " << cantidadAsientos << endl;
        if (cantidadAsientos > 0) {
            cout << "Posiciones de asientos:" << endl;
            for (int i = 0; i < cantidadAsientos; i++) {
                cout << "   - Asiento " << (i+1)
                     << ": fila " << filas[i]
                     << ", columna " << columnas[i] << endl;
            }
        }
        cout << "---------------------------------------" << endl;
        cout << "  ¡Gracias por su compra, buen viaje!  " << endl;
        cout << "=======================================\n" << endl;
    }
};

// =============================
// Clase base Persona
// =============================
class Persona {
protected:
    string nombres;
    string apellidos;
    DNI dni;

public:
    Persona() {}

    Persona(const string& nom, const string& ape, const DNI& d)
        : nombres(nom), apellidos(ape), dni(d) {}

    string getNombres() const { return nombres; }
    string getApellidos() const { return apellidos; }
    DNI getDNI() const { return dni; }
};

// =============================
// Clase Cliente hereda de Persona
// =============================
class Cliente : public Persona {
private:
    string usuario;
    string password;

    bool tieneVisa;
    VISA visa;

    Vuelo* boletos;      // memoria dinámica
    int numBoletos;
    int capacidadBoletos;

public:
    Cliente() : Persona() {
        usuario = "";
        password = "";
        tieneVisa = false;
        numBoletos = 0;
        capacidadBoletos = 10;
        boletos = new Vuelo[capacidadBoletos];
    }

    Cliente(const string& nom, const string& ape,
            const DNI& d,
            const string& user,
            const string& pass)
        : Persona(nom, ape, d)
    {
        usuario = user;
        password = pass;
        tieneVisa = false;
        numBoletos = 0;
        capacidadBoletos = 10;
        boletos = new Vuelo[capacidadBoletos];
    }

    ~Cliente() {
        delete[] boletos;
    }

    bool verificarLogin(const string& user, const string& pass) const {
        return (usuario == user && password == pass);
    }

    void registrarVisa(const VISA& v) {
        visa = v;
        tieneVisa = true;
    }

    bool tieneVisaPara(const string& pais) const {
        return (tieneVisa && (visa.getPaisDestino() == pais));
    }

    void agregarBoleto(const Vuelo& v) {
        if (numBoletos < capacidadBoletos) {
            boletos[numBoletos] = v;
            numBoletos++;
        } else {
            cout << "No se pueden agregar mas boletos a este cliente." << endl;
        }
    }

    void mostrarBoletos() const {
        if (numBoletos == 0) {
            cout << "\nNo tiene boletos comprados aún.\n";
            return;
        }

        cout << "\n--- BOLETOS COMPRADOS ---\n";
        for (int i = 0; i < numBoletos; i++) {
            cout << "\nBoleto #" << (i+1) << endl;
            boletos[i].mostrarBoleto();
        }
    }

    int getNumBoletos() const {
        return numBoletos;
    }

    Vuelo* obtenerBoleto(int indice) {
        if (indice < 0 || indice >= numBoletos) return 0;
        return &boletos[indice];
    }
};

// =============================
// Clase Horario
// =============================
class Horario
{
private:
    static const int FILAS = 10;
    static const int COLUMNAS = 6;
    char asientos[FILAS][COLUMNAS];  // 'O' libre, 'X' ocupado

    string horaSalida;
    string horaLlegada;
    int asientosTotales;
    int asientosDisponibles;

    void inicializarAsientos()
    {
        for(int i = 0; i < FILAS; i++)
        {
            for(int j = 0; j < COLUMNAS; j++)
            {
                asientos[i][j] = 'O';
            }
        }

        int total = FILAS * COLUMNAS;
        asientosTotales = total;
        asientosDisponibles = total;
    }

public:

    Horario(string salida = "", string llegada = "", int totalIgnorado = 0)
    {
        horaSalida = salida;
        horaLlegada = llegada;
        inicializarAsientos();
    }

    void mostrarHorario(int num) {
        cout << num << ". " << horaSalida
             << " -> " << horaLlegada
             << " | Asientos disponibles: " << asientosDisponibles
             << endl;
    }

    void mostrarMapaAsientos()
    {
        cout << "\nMapa de asientos (O = libre, X = ocupado)" << endl;
        cout << "    ";
        for(int c = 0; c < COLUMNAS; c++)
        {
            cout << c+1 << "  ";
        }
        cout << endl;

        for(int i = 0; i < FILAS; i++)
        {
            if(i+1 < 10) cout << " ";
            cout << i+1 << "  ";
            for(int j = 0; j < COLUMNAS; j++)
            {
                cout << asientos[i][j] << "  ";
            }
            cout << endl;
        }
    }

    bool reservarAsientoPosicion(int fila, int columna)
    {
        int f = fila - 1;
        int c = columna - 1;

        if(f < 0 || f >= FILAS || c < 0 || c >= COLUMNAS)
        {
            cout << "Posicion fuera de rango." << endl;
            return false;
        }

        if(asientos[f][c] == 'X')
        {
            cout << "Ese asiento ya esta ocupado." << endl;
            return false;
        }

        asientos[f][c] = 'X';
        asientosDisponibles--;
        cout << "Asiento (" << fila << "," << columna << ") reservado correctamente." << endl;
        return true;
    }

    bool liberarAsientoPosicion(int fila, int columna)
    {
        int f = fila - 1;
        int c = columna - 1;

        if(f < 0 || f >= FILAS || c < 0 || c >= COLUMNAS)
        {
            return false;
        }

        if(asientos[f][c] == 'X')
        {
            asientos[f][c] = 'O';
            asientosDisponibles++;
            return true;
        }
        return false;
    }

    string getHoraSalida()  const { return horaSalida; }
    string getHoraLlegada() const { return horaLlegada; }
    int getAsientosDisponibles() const { return asientosDisponibles; }
};

// =============================
// Clase Dia (no usada en flujo actual)
// =============================
class Dia
{
private:
    string fecha;
    Horario horarios[3];
    int numHorarios;

public:
    Dia(string f = "",
        Horario h1 = Horario(),
        Horario h2 = Horario(),
        Horario h3 = Horario())
    {
        fecha = f;
        horarios[0] = h1;
        horarios[1] = h2;
        horarios[2] = h3;
        numHorarios = 3;
    }

    void mostrarDia()
    {
        cout << "\nFecha: " << fecha << endl;
        for(int i=0; i < numHorarios; i++)
            horarios[i].mostrarHorario(i+1);
    }

    bool reservar(int indice, int cant)
    {
        return false;
    }

    string getFecha() {
        return fecha;
    }
};

// =============================
// Clase Pais
// =============================
class Pais
{
private:
    string nombre;
    string aerolinea1;
    string aerolinea2;
    string aerolinea3;
    Horario horarios[3];

public:

    Pais(string n = "", string a1 = "", string a2 = "", string a3 = "",
         Horario h1 = Horario(), Horario h2 = Horario(), Horario h3 = Horario())
    {
        nombre = n;
        aerolinea1 = a1;
        aerolinea2 = a2;
        aerolinea3 = a3;
        horarios[0] = h1;
        horarios[1] = h2;
        horarios[2] = h3;
    }

    string getNombre()        { return nombre; }
    string getAerolinea1()    { return aerolinea1; }
    string getAerolinea2()    { return aerolinea2; }
    string getAerolinea3()    { return aerolinea3; }

    void mostrarAerolineas()
    {
        cout << "\nAerolineas disponibles para " << nombre << ":" << endl;
        cout << "1. " << aerolinea1 << endl;
        cout << "2. " << aerolinea2 << endl;
        cout << "3. " << aerolinea3 << endl;
    }

    void mostrarHorarios()
    {
        cout << "\nHorarios disponibles para " << nombre << ":" << endl;
        for(int i = 0; i < 3; i++)
        {
            horarios[i].mostrarHorario(i+1);
        }
    }

    Horario& getHorario(int indice) {
        return horarios[indice];
    }
};

// =============================
// Función auxiliar: paisRequiereVisa
// =============================
bool paisRequiereVisa(const string& nombrePais) {
    if (nombrePais == "España" ||
        nombrePais == "Canada" ||
        nombrePais == "Portugal") {
        return true;
    }
    return false;
}

// =============================
// Clase Menu
// =============================
class Menu
{
private:
    Pais paises[7];

    Cliente** clientes;   // arreglo dinámico de punteros a Cliente
    int numClientes;
    int capacidadClientes;

    Cliente* clienteActual; // puntero al cliente logueado

public:
    Menu();
    ~Menu();

    void mostrar_boletos();
    void comprar_vuelo();
    void modificar_voleto();
    void registrarCliente();
    void iniciarSesion();
    void registrarVisaCliente();
    void menuPrincipal();
};

// =============================
// Implementacion de Menu
// =============================
Menu::Menu()
{
    capacidadClientes = 10;
    numClientes = 0;
    clientes = new Cliente*[capacidadClientes];
    clienteActual = 0;

    // Clientes precargados (dinámicos)
    DNI d0("Gustavo Alonso", "Moreno Ojeda", "peruana", "M", "72385379");
    clientes[numClientes++] = new Cliente("Gustavo Alonso", "Moreno Ojeda", d0, "gustavo", "1234");

    DNI d1("Manuel Eduardo", "Loaiza Fernadez", "peruana", "M", "123");
    clientes[numClientes++] = new Cliente("Manuel Eduardo", "Loaiza Fernadez", d1, "manuel", "1234");

    DNI d2("Alvaro Henry", "Mamani Aliaga", "peruana", "M", "321");
    clientes[numClientes++] = new Cliente("Alvaro Henry", "Mamani Aliaga", d2, "alvaro", "1234");

    DNI d3("Wiliams Yeferson", "Taipe Huanca", "peruana", "M", "456");
    clientes[numClientes++] = new Cliente("Wiliams Yeferson", "Taipe Huanca", d3, "wiliams", "1234");

    DNI d4("Luis Carlos", "Unancha Chavez", "peruana", "M", "4321");
    clientes[numClientes++] = new Cliente("Luis Carlos", "Unancha Chavez", d4, "luis", "1234");

    // Inicializar paises y horarios
    paises[0] = Pais("Mexico", "Aeromexico", "Volaris", "Interjet",
                     Horario("06:00", "10:00"),
                     Horario("13:30", "17:30"),
                     Horario("21:00", "01:00"));

    paises[1] = Pais("España", "Iberia", "Vueling", "Air Europa",
                     Horario("08:00", "16:00"),
                     Horario("14:00", "22:00"),
                     Horario("23:00", "07:00"));

    paises[2] = Pais("Bolivia", "Boliviana de Aviacion", "Aerosur", "Amaszonas",
                     Horario("07:00", "09:30"),
                     Horario("12:00", "14:30"),
                     Horario("18:00", "20:30"));

    paises[3] = Pais("Canada", "Air Canada", "WestJet", "Air Transat",
                     Horario("09:00", "17:00"),
                     Horario("15:00", "23:00"),
                     Horario("22:00", "06:00"));

    paises[4] = Pais("Portugal", "TAP Portugal", "SATA Internacional", "EuroAtlantic",
                     Horario("10:00", "18:00"),
                     Horario("16:00", "00:00"),
                     Horario("23:30", "07:30"));

    paises[5] = Pais("Argentina", "Aerolineas Argentinas", "Flybondi", "JetSmart",
                     Horario("05:30", "09:30"),
                     Horario("11:00", "15:00"),
                     Horario("19:00", "23:00"));

    paises[6] = Pais("Colombia", "Avianca", "LATAM Colombia", "Viva Air",
                     Horario("06:30", "10:30"),
                     Horario("13:00", "17:00"),
                     Horario("20:00", "00:00"));
}

Menu::~Menu()
{
    for (int i = 0; i < numClientes; i++) {
        delete clientes[i];
    }
    delete[] clientes;
}

void Menu::mostrar_boletos()
{
    if (clienteActual == 0) {
        cout << "Debe iniciar sesion para ver sus boletos." << endl;
        return;
    }

    clienteActual->mostrarBoletos();
}

void Menu::registrarCliente()
{
    if (numClientes >= capacidadClientes) {
        cout << "No hay mas espacio para registrar clientes." << endl;
        return;
    }

    cin.ignore(); // limpiar salto de linea previo

    string nombres, apellidos, nacionalidad, sexo, numeroDni;
    string usuario, password;

    cout << "\n--- REGISTRO DE CLIENTE ---" << endl;
    cout << "Ingrese nombres: ";
    getline(cin, nombres);
    cout << "Ingrese apellidos: ";
    getline(cin, apellidos);
    cout << "Ingrese nacionalidad: ";
    getline(cin, nacionalidad);
    cout << "Ingrese sexo (M/F): ";
    getline(cin, sexo);
    cout << "Ingrese numero de DNI: ";
    getline(cin, numeroDni);

    cout << "Cree un nombre de usuario (sin espacios): ";
    cin >> usuario;
    cout << "Cree una contraseña (sin espacios): ";
    cin >> password;

    DNI d(nombres, apellidos, nacionalidad, sexo, numeroDni);
    clientes[numClientes] = new Cliente(nombres, apellidos, d, usuario, password);
    numClientes++;

    cout << "Registro completado correctamente." << endl;
}

void Menu::iniciarSesion()
{
    string user, pass;

    cout << "\n--- INICIAR SESION ---" << endl;
    cout << "Usuario: ";
    cin >> user;
    cout << "Contraseña: ";
    cin >> pass;

    for (int i = 0; i < numClientes; i++) {
        if (clientes[i]->verificarLogin(user, pass)) {
            clienteActual = clientes[i];
            cout << "Inicio de sesion exitoso. Bienvenido, "
                 << clienteActual->getNombres() << " "
                 << clienteActual->getApellidos() << endl;
            return;
        }
    }

    cout << "Credenciales incorrectas. No se pudo iniciar sesion." << endl;
    clienteActual = 0;
}

void Menu::registrarVisaCliente()
{
    if (clienteActual == 0) {
        cout << "Debe iniciar sesion para registrar una VISA." << endl;
        return;
    }

    string numVisa, tipoVisa, paisDest, fEmi, fVen;

    cout << "\n--- REGISTRAR VISA ---" << endl;
    cout << "Numero de VISA: ";
    cin >> numVisa;
    cout << "Pais destino de la VISA: ";
    cin >> paisDest;
    cout << "Tipo de VISA (turista, estudio, trabajo, etc.): ";
    cin >> tipoVisa;
    cout << "Fecha de emision (dd/mm/aaaa): ";
    cin >> fEmi;
    cout << "Fecha de vencimiento (dd/mm/aaaa): ";
    cin >> fVen;

    VISA v(numVisa, tipoVisa, paisDest, fEmi, fVen);
    clienteActual->registrarVisa(v);

    cout << "VISA registrada y asociada a su cuenta correctamente." << endl;
}

void Menu::comprar_vuelo()
{
    if (clienteActual == 0) {
        cout << "Debe iniciar sesion antes de comprar un vuelo." << endl;
        return;
    }

    int opcionPais, opcionAerolinea;

    cout << "\n--- COMPRAR VUELO ---" << endl;
    cout << "\nSeleccione el pais de destino:" << endl;

    cout << "\n 1. Mexico" << endl;
    cout << " 2. España" << endl;
    cout << " 3. Bolivia" << endl;
    cout << " 4. Canada" << endl;
    cout << " 5. Portugal" << endl;
    cout << " 6. Argentina" << endl;
    cout << " 7. Colombia" << endl;
    cout << endl;

    cout << "Opcion: ";
    cin >> opcionPais;

    if(opcionPais < 1 || opcionPais > 7)
    {
        cout << "Opcion de pais no valida!" << endl;
        return;
    }

    int indexPais = opcionPais - 1;
    Pais &paisSeleccionado = paises[indexPais];

    paisSeleccionado.mostrarAerolineas();

    cout << endl;
    cout << "Seleccione la aerolinea (1-3): ";
    cin >> opcionAerolinea;

    if(opcionAerolinea < 1 || opcionAerolinea > 3) {
        cout << "Opcion de aerolinea no valida!" << endl;
        return;
    }

    string aerolineaSeleccionada;
    switch(opcionAerolinea) {
        case 1:
            aerolineaSeleccionada = paisSeleccionado.getAerolinea1();
            break;
        case 2:
            aerolineaSeleccionada = paisSeleccionado.getAerolinea2();
            break;
        case 3:
            aerolineaSeleccionada = paisSeleccionado.getAerolinea3();
            break;
    }

    cout << "\nSeleccion confirmada!" << endl;
    cout << "Pais: " << paisSeleccionado.getNombre() << endl;
    cout << "Aerolinea: " << aerolineaSeleccionada << endl;

    // VISA: solo verificación
    if (paisRequiereVisa(paisSeleccionado.getNombre())) {
        cout << "\nADVERTENCIA: El pais de destino requiere VISA." << endl;
        if (!clienteActual->tieneVisaPara(paisSeleccionado.getNombre())) {
            cout << "Usted NO tiene registrada una VISA para este pais." << endl;
            cout << "Primero debe registrar su VISA en la opcion 'REGISTRAR VISA' del menu." << endl;
            return;
        } else {
            cout << "VISA valida registrada para este pais. " << endl;
        }
    }

    // Fecha del vuelo
    string fechaVuelo;
    cout << "\nIngrese fecha del vuelo (dd/mm/aaaa): ";
    cin >> fechaVuelo;

    cout << "\nPuede continuar con su compra." << endl;

    paisSeleccionado.mostrarHorarios();

    int opcionHorario;
    cout << "\nSeleccione el horario (1-3): ";
    cin >> opcionHorario;

    if(opcionHorario < 1 || opcionHorario > 3)
    {
        cout << "Opcion de horario no valida!" << endl;
        return;
    }

    int indexHorario = opcionHorario - 1;
    Horario &hSel = paisSeleccionado.getHorario(indexHorario);

    int cantidadAsientos;
    cout << "Ingrese la cantidad de asientos a reservar (max 10): ";
    cin >> cantidadAsientos;

    if(cantidadAsientos <= 0 || cantidadAsientos > 10) {
        cout << "Cantidad invalida (debe ser entre 1 y 10)." << endl;
        return;
    }

    if(cantidadAsientos > hSel.getAsientosDisponibles())
    {
        cout << "No hay suficientes asientos disponibles en este horario." << endl;
        return;
    }

    hSel.mostrarMapaAsientos();

    cout << "\nAhora seleccione la posicion de cada asiento (fila y columna)." << endl;

    Vuelo vuelo(
        paisSeleccionado.getNombre(),
        aerolineaSeleccionada,
        hSel.getHoraSalida(),
        hSel.getHoraLlegada(),
        fechaVuelo,
        0,
        indexPais,
        indexHorario
    );

    int reservados = 0;
    while(reservados < cantidadAsientos)
    {
        int fila, columna;
        cout << "\nAsiento " << (reservados+1) << " de " << cantidadAsientos << endl;
        cout << "Fila (1-10): ";
        cin >> fila;
        cout << "Columna (1-6): ";
        cin >> columna;

        if(hSel.reservarAsientoPosicion(fila, columna))
        {
            vuelo.agregarAsiento(fila, columna); // guardamos la posicion en el boleto
            reservados++;
            hSel.mostrarMapaAsientos();
        }
        else
        {
            cout << "Intente con otra posicion." << endl;
        }
    }

    cout << "\nCompra realizada con exito!" << endl;

    clienteActual->agregarBoleto(vuelo);   // guardamos el boleto
    vuelo.mostrarBoleto();                 // mostramos el boleto
}

// =============================
// MODIFICAR BOLETO
// =============================
void Menu::modificar_voleto()
{
    if (clienteActual == 0) {
        cout << "Debe iniciar sesion para modificar un boleto." << endl;
        return;
    }

    int num = clienteActual->getNumBoletos();
    if (num == 0) {
        cout << "No tiene boletos para modificar." << endl;
        return;
    }

    cout << "\n--- MODIFICAR BOLETO ---" << endl;
    cout << "Boletos disponibles:\n";

    for (int i = 0; i < num; i++) {
        Vuelo* vbTmp = clienteActual->obtenerBoleto(i);
        cout << (i+1) << ". Destino: " << vbTmp->getPaisDestino()
             << " | Fecha: " << vbTmp->getFecha()
             << " | " << vbTmp->getHoraSalida() << " - " << vbTmp->getHoraLlegada()
             << " | Asientos: " << vbTmp->getCantidad()
             << endl;
    }

    int opcionBoleto;
    cout << "\nSeleccione el numero de boleto a modificar: ";
    cin >> opcionBoleto;

    if (opcionBoleto < 1 || opcionBoleto > num) {
        cout << "Opcion de boleto invalida." << endl;
        return;
    }

    Vuelo* vb = clienteActual->obtenerBoleto(opcionBoleto - 1);
    if (!vb) {
        cout << "Error interno al acceder al boleto." << endl;
        return;
    }

    int pIndex = vb->getIndexPais();
    int hIndex = vb->getIndexHorario();

    if (pIndex < 0 || pIndex >= 7 || hIndex < 0 || hIndex > 2) {
        cout << "Error: indices de pais/horario invalidos para este boleto." << endl;
        return;
    }

    char resp;
    bool cambioHorario = false;
    bool cambioFecha = false;

    // 1) MODIFICAR FECHA
    cout << "\nFecha actual: " << vb->getFecha() << endl;
    cout << "¿Desea modificar la fecha? (s/n): ";
    cin >> resp;

    if (resp == 's' || resp == 'S') {
        string nuevaFecha;
        cout << "Nueva fecha (dd/mm/aaaa): ";
        cin >> nuevaFecha;
        vb->setFecha(nuevaFecha);
        cout << "Fecha actualizada." << endl;
        cambioFecha = true;
    }

    // 2) MODIFICAR HORARIO
    if (cambioFecha) {
        cout << "\nComo ha cambiado la fecha, seleccione el horario para ese dia." << endl;
        cout << "Horarios disponibles para " << paises[pIndex].getNombre() << ":\n";
        paises[pIndex].mostrarHorarios();

        int nuevoHor;
        cout << "Seleccione nuevo horario (1-3): ";
        cin >> nuevoHor;

        if (nuevoHor < 1 || nuevoHor > 3) {
            cout << "Horario invalido, se mantiene el horario anterior." << endl;
        } else {
            int nuevoIndex = nuevoHor - 1;

            if (nuevoIndex != hIndex) {
                Horario &oldH = paises[pIndex].getHorario(hIndex);
                Horario &newH = paises[pIndex].getHorario(nuevoIndex);

                int cant = vb->getCantidad();

                if (cant > newH.getAsientosDisponibles()) {
                    cout << "No hay suficientes asientos en el nuevo horario para mantener la misma cantidad." << endl;
                    cout << "No se cambia el horario (solo se cambio la fecha)." << endl;
                } else {
                    for (int i = 0; i < cant; i++) {
                        int f = vb->getFilaAsiento(i);
                        int c = vb->getColumnaAsiento(i);
                        if (f != -1 && c != -1) {
                            oldH.liberarAsientoPosicion(f, c);
                        }
                    }

                    cout << "\nSeleccione las nuevas posiciones de asientos para el nuevo horario:" << endl;
                    newH.mostrarMapaAsientos();

                    for (int i = 0; i < cant; i++) {
                        int f, c;
                        bool reservado = false;
                        do {
                            cout << "\nAsiento " << (i+1) << " de " << cant << endl;
                            cout << "Fila (1-10): ";
                            cin >> f;
                            cout << "Columna (1-6): ";
                            cin >> c;

                            if (newH.reservarAsientoPosicion(f, c)) {
                                vb->setAsiento(i, f, c);
                                reservado = true;
                                newH.mostrarMapaAsientos();
                            } else {
                                cout << "No se pudo reservar esa posicion. Intente otra." << endl;
                            }
                        } while (!reservado);
                    }

                    vb->setHoraSalida(newH.getHoraSalida());
                    vb->setHoraLlegada(newH.getHoraLlegada());
                    vb->setIndexHorario(nuevoIndex);
                    hIndex = nuevoIndex;
                    cambioHorario = true;

                    cout << "Horario y asientos actualizados para el nuevo horario." << endl;
                }
            } else {
                cout << "Se mantiene el mismo horario (solo ha cambiado la fecha)." << endl;
            }
        }
    } else {
        cout << "\nHorario actual: " << vb->getHoraSalida()
             << " - " << vb->getHoraLlegada() << endl;
        cout << "¿Desea cambiar a otro horario disponible? (s/n): ";
        cin >> resp;

        if (resp == 's' || resp == 'S') {
            cout << "\nHorarios disponibles para " << paises[pIndex].getNombre() << ":\n";
            paises[pIndex].mostrarHorarios();

            int nuevoHor;
            cout << "Seleccione nuevo horario (1-3): ";
            cin >> nuevoHor;

            if (nuevoHor < 1 || nuevoHor > 3) {
                cout << "Horario invalido, no se cambia el horario." << endl;
            } else {
                int nuevoIndex = nuevoHor - 1;

                if (nuevoIndex != hIndex) {
                    Horario &oldH = paises[pIndex].getHorario(hIndex);
                    Horario &newH = paises[pIndex].getHorario(nuevoIndex);

                    int cant = vb->getCantidad();

                    if (cant > newH.getAsientosDisponibles()) {
                        cout << "No hay suficientes asientos en el nuevo horario para mantener la misma cantidad." << endl;
                        cout << "No se cambia el horario." << endl;
                    } else {
                        for (int i = 0; i < cant; i++) {
                            int f = vb->getFilaAsiento(i);
                            int c = vb->getColumnaAsiento(i);
                            if (f != -1 && c != -1) {
                                oldH.liberarAsientoPosicion(f, c);
                            }
                        }

                        cout << "\nSeleccione las nuevas posiciones de asientos para el nuevo horario:" << endl;
                        newH.mostrarMapaAsientos();

                        for (int i = 0; i < cant; i++) {
                            int f, c;
                            bool reservado = false;
                            do {
                                cout << "\nAsiento " << (i+1) << " de " << cant << endl;
                                cout << "Fila (1-10): ";
                                cin >> f;
                                cout << "Columna (1-6): ";
                                cin >> c;

                                if (newH.reservarAsientoPosicion(f, c)) {
                                    vb->setAsiento(i, f, c);
                                    reservado = true;
                                    newH.mostrarMapaAsientos();
                                } else {
                                    cout << "No se pudo reservar esa posicion. Intente otra." << endl;
                                }
                            } while (!reservado);
                        }

                        vb->setHoraSalida(newH.getHoraSalida());
                        vb->setHoraLlegada(newH.getHoraLlegada());
                        vb->setIndexHorario(nuevoIndex);
                        hIndex = nuevoIndex;
                        cambioHorario = true;

                        cout << "Horario y asientos actualizados para el nuevo horario." << endl;
                    }
                } else {
                    cout << "Eligio el mismo horario, no se modifican los asientos." << endl;
                }
            }
        }
    }

    // 3) MODIFICAR ASIENTOS SOLO SI NO CAMBIO HORARIO
    if (!cambioHorario) {
        cout << "\nAsientos actuales: " << vb->getCantidad() << endl;
        cout << "¿Desea cambiar cantidad y posiciones de asientos? (s/n): ";
        cin >> resp;

        if (resp == 's' || resp == 'S') {
            Horario &h = paises[pIndex].getHorario(hIndex);

            int cantActual = vb->getCantidad();
            int asientosLibres = h.getAsientosDisponibles() + cantActual;

            int nuevaCant;
            cout << "Nueva cantidad de asientos (max 10): ";
            cin >> nuevaCant;

            if (nuevaCant <= 0 || nuevaCant > 10) {
                cout << "Cantidad invalida, no se modifica." << endl;
            } else if (nuevaCant > asientosLibres) {
                cout << "No hay suficientes asientos libres en este horario para esa cantidad." << endl;
                cout << "No se modifican los asientos." << endl;
            } else {
                for (int i = 0; i < cantActual; i++) {
                    int f = vb->getFilaAsiento(i);
                    int c = vb->getColumnaAsiento(i);
                    if (f != -1 && c != -1) {
                        h.liberarAsientoPosicion(f, c);
                    }
                }

                vb->setCantidadAsientos(nuevaCant);

                cout << "\nSeleccione las nuevas posiciones de asientos:" << endl;
                h.mostrarMapaAsientos();

                for (int i = 0; i < nuevaCant; i++) {
                    int f, c;
                    bool reservado = false;
                    do {
                        cout << "\nAsiento " << (i+1) << " de " << nuevaCant << endl;
                        cout << "Fila (1-10): ";
                        cin >> f;
                        cout << "Columna (1-6): ";
                        cin >> c;

                        if (h.reservarAsientoPosicion(f, c)) {
                            vb->setAsiento(i, f, c);
                            reservado = true;
                            h.mostrarMapaAsientos();
                        } else {
                            cout << "No se pudo reservar esa posicion. Intente otra." << endl;
                        }
                    } while (!reservado);
                }

                cout << "Asientos actualizados." << endl;
            }
        }
    }

    cout << "\nBoleto modificado final:\n";
    vb->mostrarBoleto();
}

void Menu::menuPrincipal()
{
    int opcionLogin;

    do {
        cout << "\n=== SISTEMA DE AEROLINEA UCSP ===" << endl;
        cout << "1. Iniciar sesion" << endl;
        cout << "2. Registrarse" << endl;
        cout << "3. Salir" << endl;
        cout << "Opcion: ";
        cin >> opcionLogin;

        switch(opcionLogin) {
        case 1:
            iniciarSesion();
            if (clienteActual != 0) {
                int opcion;
                do {
                    cout << "\n--- MENU PRINCIPAL ---" << endl;
                    cout << "Cliente: " << clienteActual->getNombres()
                         << " " << clienteActual->getApellidos() << endl;
                    cout << "1. MOSTRAR BOLETOS" << endl;
                    cout << "2. COMPRAR VUELO" << endl;
                    cout << "3. MODIFICAR BOLETO" << endl;
                    cout << "4. REGISTRAR VISA" << endl;
                    cout << "5. Cerrar sesion" << endl;
                    cout << "Opcion: ";
                    cin >> opcion;

                    switch(opcion) {
                    case 1:
                        mostrar_boletos();
                        break;
                    case 2:
                        comprar_vuelo();
                        break;
                    case 3:
                        modificar_voleto();
                        break;
                    case 4:
                        registrarVisaCliente();
                        break;
                    case 5:
                        cout << "Cerrando sesion..." << endl;
                        break;
                    default:
                        cout << "Opcion no valida!" << endl;
                        break;
                    }
                } while(opcion != 5);

                clienteActual = 0; // cerrar sesion
            }
            break;

        case 2:
            registrarCliente();
            break;

        case 3:
            cout << "Saliendo del sistema..." << endl;
            break;

        default:
            cout << "Opcion no valida!" << endl;
            break;
        }

    } while (opcionLogin != 3);
}

//-----------------------------------------
int main()
{
    Menu s1;
    s1.menuPrincipal();
    return 0;
}
